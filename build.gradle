plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.5'
    id 'org.jetbrains.kotlin.jvm' version "$kotlinVersion"
    id 'io.spring.dependency-management' version '1.1.0'

    id "org.jetbrains.kotlin.plugin.spring" version "$kotlinVersion"
    id "org.jetbrains.kotlin.plugin.allopen" version "$kotlinVersion"
}

sourceSets.getByName("main").java.srcDir("$buildDir/src/main/kotlin")
sourceSets.test.java.srcDir("src/test/kotlin")

group = "org.mikehenry"
version = "1.0-SNAPSHOT"

allprojects {
    java {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }
    repositories {
        mavenCentral()
    }
}

dependencies {
    implementation "org.springframework.boot:spring-boot-starter-actuator"
    implementation "org.springframework.boot:spring-boot-starter-data-jpa"
    implementation "org.springframework.boot:spring-boot-starter-validation"
    implementation "org.springframework.boot:spring-boot-starter-web"
    implementation("com.fasterxml.jackson.module:jackson-module-kotlin")

    runtimeOnly "org.apache.tomcat.embed:tomcat-embed-core"
    runtimeOnly "org.liquibase:liquibase-core:$liquibaseVersion"
    runtimeOnly "mysql:mysql-connector-java"

    testImplementation "io.gihub.serpro69:kotlin-faker:$kotlinFakerVersion"
    testImplementation "com.h2database:h2:$h2DatabaseVersion"
    testImplementation "org.springframework.boot:spring-boot-starter-test"
    testImplementation "io.kotest:kotest-runner-junit5:$kotlinVersion"
    testImplementation "io.kotest:kotest-assertions-core:$kotlinVersion"
    testImplementation "io.kotest:kotest-property:$kotlinVersion"
    testImplementation "io.kotest.extension:kotest-extension-spring:$kotlinSpringVersion"
}

compileKotlin {
    kotlinOptions {
        jvmTarget = "17"
    }
}

compileTestKotlin {
    kotlinOptions {
        jvmTarget = "17"
    }
}

tasks.withType(Test) {
    useJUnitPlatform()

    testLogging {
        events "skipped", "failed"
        exceptionFormat "full"
        showCauses true
        showExceptions true
        showStackTraces true
    }
}

springBoot.buildInfo()